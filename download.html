<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download - TextureAtlas Toolbox</title>
    <meta name="description" content="Download TextureAtlas Toolbox - Free and open-source texture atlas tool for extraction, generation, and editing">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/download.css">
    <link rel="icon" type="image/svg+xml" href="assets/icons/app.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="index.html">
                        <img src="assets/icons/app.svg" alt="TextureAtlas Toolbox" class="logo-icon">
                        TextureAtlas Toolbox
                    </a>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="download.html" class="nav-link active">Download</a>
                    </li>
                    <li class="nav-item">
                        <a href="documentation.html" class="nav-link">Documentation</a>
                    </li>
                    <li class="nav-item">
                        <a href="gallery.html" class="nav-link">Gallery</a>
                    </li>
                    <li class="nav-item">
                        <a href="about.html" class="nav-link">About</a>
                    </li>
                </ul>
                <div class="nav-controls">
                    <!-- Theme toggle will be added here by JavaScript -->
                </div>
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <main class="main-content">
        <section class="hero-section">
            <div class="container">
                <h1>üì• Download TextureAtlas Toolbox</h1>
            </div>
        </section>

        <section class="download-section">
            <div class="container">
                <div class="download-options" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                    <div class="download-card primary" id="v2-card">
                        <h3>üöÄ Latest Release (v2.x)</h3>
                        <div class="version-info">
                            <span class="version" id="v2-version">Loading...</span>
                            <span class="release-date" id="v2-date">Fetching latest...</span>
                        </div>
                        <p>Recommended for most users. Features Extract, Generate, and Editor tabs with Qt-based UI.</p>
                        
                        <div class="download-options-container" id="v2-assets">
                            <!-- Executable Package -->
                            <div class="download-group">
                                <div class="download-group-header">
                                    <span class="group-icon">‚ö°</span>
                                    <div class="group-info">
                                        <span class="group-title">Standalone Executable</span>
                                        <span class="group-desc">No Python required, ready to run</span>
                                    </div>
                                </div>
                                <div class="download-group-buttons" id="v2-exe-buttons">
                                    <span class="loading-placeholder">Loading...</span>
                                </div>
                            </div>
                            
                            <!-- Embedded Python Package -->
                            <div class="download-group">
                                <div class="download-group-header">
                                    <span class="group-icon">üêç</span>
                                    <div class="group-info">
                                        <span class="group-title">Embedded Python</span>
                                        <span class="group-desc">Includes Python runtime, ready to run</span>
                                    </div>
                                </div>
                                <div class="download-group-buttons" id="v2-embedded-buttons">
                                    <span class="loading-placeholder">Loading...</span>
                                </div>
                            </div>
                            
                            <!-- Source Code -->
                            <div class="download-group">
                                <div class="download-group-header">
                                    <span class="group-icon">üì¶</span>
                                    <div class="group-info">
                                        <span class="group-title">Source Code</span>
                                        <span class="group-desc">Requires Python 3.14+ and dependencies</span>
                                    </div>
                                </div>
                                <div class="download-group-buttons" id="v2-source-buttons">
                                    <span class="loading-placeholder">Loading...</span>
                                </div>
                            </div>
                        </div>
                        
                        <a id="v2-releases-link" href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/releases" class="releases-link">
                            View all releases on GitHub ‚Üí
                        </a>
                    </div>
                    
                    <div class="download-card" id="v1-card">
                        <h3>üì¶ Legacy Release (v1.x)</h3>
                        <div class="version-info">
                            <span class="version" id="v1-version">Loading...</span>
                            <span class="release-date" id="v1-date">Final v1 Release</span>
                        </div>
                        <p>Legacy version with Tkinter UI. <strong>Only supports spritesheet extraction</strong> (no atlas generation or editor). For users who prefer the original interface or need compatibility with older systems.</p>
                        
                        <div class="download-options-container">
                            <!-- Executable Package -->
                            <div class="download-group">
                                <div class="download-group-header">
                                    <span class="group-icon">‚ö°</span>
                                    <div class="group-info">
                                        <span class="group-title">Executable (Windows)</span>
                                        <span class="group-desc">No Python required, ready to run</span>
                                    </div>
                                </div>
                                <div class="download-group-buttons" id="v1-exe-buttons">
                                    <a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/releases/download/v1.9.5.1/TextureAtlas.to.GIF.and.Frames.v1.9.5.1.zip" class="btn btn-primary">ZIP (46.7 MB)</a>
                                    <a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/releases/download/v1.9.5.1/TextureAtlas.to.GIF.and.Frames.v1.9.5.1.7z" class="btn btn-outline">7Z (28.1 MB)</a>
                                </div>
                            </div>
                            
                            <!-- Source Code -->
                            <div class="download-group">
                                <div class="download-group-header">
                                    <span class="group-icon">üì¶</span>
                                    <div class="group-info">
                                        <span class="group-title">Source Code</span>
                                        <span class="group-desc">Requires Python 3.10+ and dependencies</span>
                                    </div>
                                </div>
                                <div class="download-group-buttons" id="v1-source-buttons">
                                    <a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/archive/refs/tags/v1.9.5.1.zip" class="btn btn-primary">ZIP</a>
                                    <a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/archive/refs/tags/v1.9.5.1.tar.gz" class="btn btn-outline">TAR.GZ</a>
                                </div>
                            </div>
                        </div>
                        
                        <a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/releases/tag/v1.9.5.1" class="releases-link">
                            View release on GitHub ‚Üí
                        </a>
                    </div>
                </div>

                <div class="mirrors-section">
                    <h2>üåê Alternative Download Mirrors</h2>
                    <p class="mirrors-description">This tool is also available on:</p>
                    
                    <div class="mirrors-grid">
                        <div class="mirror-card">
                            <div class="mirror-header">
                                <img src="assets/third-party/itchio-icon.svg" alt="itch.io" class="mirror-icon">
                            </div>
                            <a href="https://autisticlulu.itch.io/textureatlas-to-gif-and-frames" class="btn btn-secondary">
                                üì• Download from itch.io
                            </a>
                        </div>

                        <div class="mirror-card">
                            <div class="mirror-header">
                                <img src="assets/third-party/gamebanana-icon.png" alt="GameBanana" class="mirror-icon">
                            </div>
                            <a href="https://gamebanana.com/tools/16621" class="btn btn-secondary">
                                üì• Download from GameBanana
                            </a>
                        </div>

                        <div class="mirror-card">
                            <div class="mirror-header">
                                <img src="assets/third-party/sourceforge-icon.svg" alt="SourceForge" class="mirror-icon">
                            </div>
                            <a href="https://sourceforge.net/projects/textureatlas-to-gif-and-frames/" class="btn btn-secondary">
                                üì• Download from SourceForge
                            </a>
                        </div>
                    </div>
                    <div class="important-notices">
                        <h4>‚ö†Ô∏è Important Notices</h4>
                        <ul>
                            <li>Only download from official sources listed above</li>
                            <li>I'm not responsible for any damage or issues caused by downloading from unofficial sites.</li>
                        </ul>
                    </div>
                </div>
                <div class="requirements-section">
                    <h2>üìã System Requirements</h2>
                    
                    <div class="requirements-container">
                        <table class="requirements-table">
                            <thead>
                                <tr>
                                    <th>Component</th>
                                    <th>üíª Minimum Requirements</th>
                                    <th>üåü Recommended Requirements</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>üñ•Ô∏è Operating System</td>
                                    <td>Windows 10+, macOS 11+, or Linux (Ubuntu 20.04+/Debian 11+/Fedora 36+)</td>
                                    <td>Windows 10/11 (64-bit), macOS 11+ (Big Sur or later), or recent Linux (Ubuntu 22.04+/Fedora 38+)</td>
                                </tr>
                                <tr>
                                    <td>‚ö° CPU</td>
                                    <td>At least 2 cores (dual-core or better required)</td>
                                    <td>Quad-core or better</td>
                                </tr>
                                <tr>
                                    <td>üêç Python</td>
                                    <td>Version 3.14 or higher (for manual installation)</td>
                                    <td>Version 3.14 or higher (64-bit) (for manual installation)</td>
                                </tr>
                                <tr>
                                    <td>üß† Memory</td>
                                    <td>At least 8GB RAM</td>
                                    <td>16GB or more (32GB+ recommended for batch processing large atlases)</td>
                                </tr>
                                <tr>
                                    <td>üíæ Storage</td>
                                    <td>1GB for application + output of single spritesheet processing (5GB+ recommended for batch processing)</td>
                                    <td>SSD with 10GB+ free space for faster processing speeds</td>
                                </tr>
                                <tr>
                                    <td>üåê Internet Access</td>
                                    <td>Required for downloading dependencies and updates</td>
                                    <td>Required for downloading dependencies and updates</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="important-notices">
                            <h4>‚ö†Ô∏è Important Notices</h4>
                            <ul>
                                <li>32-bit operating systems are <strong>not officially supported</strong> and will <strong>not receive troubleshooting help</strong>.</li>
                                <li>Operating systems below macOS 11, Windows 10, and older Linux distributions are <strong>not officially supported</strong> and will <strong>not receive troubleshooting help</strong>.</li>
                                <li>Python versions below 3.14 are <strong>not officially supported</strong> and will <strong>not receive troubleshooting help</strong>.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="installation-section">
                    <h2>üõ†Ô∏è Installation Guide</h2>
                    
                    <div class="installation-methods">
                        <div class="method-card">
                            <h3>‚ú® Quick Install (Windows only)</h3>
                            <ol class="install-steps">
                                <li>Download the latest release <code>.zip</code> or <code>.7z</code> file.</li>
                                <li>Extract all files to a folder of your choice (e.g., <code>C:\TextureAtlasToolbox</code>).</li>
                                <li>Run <code>TextureAtlas Toolbox.exe</code></li>
                            </ol>
                            <div class="note">
                                <strong>Note:</strong> This method is only available for Windows users. It includes all dependencies and does not require Python or ImageMagick.
                                <br>macOS and Linux users must use the manual installation method.
                            </div>
                            <div class="note warning">
                                <strong>Note:</strong> The executable releases for Windows may get detected as a false positive by some antivirus software.
                                <br>You can read more about this <a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/issues/20" target="_blank">here</a>.
                                <br>Alternatively, you can use the manual installation method.
                            </div>
                        </div>

                        <div class="method-card">
                            <h3>‚öôÔ∏è Manual Installation</h3>
                            <ol class="install-steps">
                                <li>Ensure Python is installed on your system</li>
                                <li>Download and extract the source code</li>
                                <li>Open a command prompt/terminal in the extracted folder</li>
                                <li>Install dependencies: <code>pip install -r requirements.txt</code></li>
                                <li>Run the application: <code>python src/Main.py</code></li>
                            </ol>
                            <div class="note">
                                <strong>Note:</strong> For full installation instructions, including ImageMagick setup, refer to the <a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/blob/main/docs/installation-guide.md#manual-installation">Installation Guide</a>.
                            </div>
                        </div>
                    </div>
                </div>

                <div class="updates-section">
                    <h2>üîÑ Updates & Version History</h2>
                    
                    <div class="update-info">
                        <h3>üîÅ Automatic Updates</h3>
                        <p>The application includes an automatic update system:</p>
                        <ul>
                            <li>‚úÖ Checks for updates on startup (can be disabled)</li>
                            <li>‚úÖ Optional auto-download of updates</li>
                            <li>‚úÖ Manual update check available in <strong>Options ‚Üí Check for Updates</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Project</h4>
                    <ul>
                        <li><a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames">GitHub Repository</a></li>
                        <li><a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/releases">Releases</a></li>
                        <li><a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/issues">Bug Reports</a></li>
                        <li><a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/discussions">Discussions</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Documentation</h4>
                    <ul>
                        <li><a href="documentation.html">User Manual</a></li>
                        <li><a href="documentation.html#installation">Installation</a></li>
                        <li><a href="documentation.html#troubleshooting">Troubleshooting</a></li>
                        <li><a href="documentation.html#api">API Reference</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Community</h4>
                    <ul>
                        <li><a href="about.html">About</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/blob/main/LICENSE">License</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Project started by AutisticLulu. Licensed under <a href="https://github.com/MeguminBOT/TextureAtlas-to-GIF-and-Frames/blob/main/LICENSE">AGPL-3.0</a></p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // GitHub Release API Configuration (mirrors version.py)
        const REPO_V2 = {
            owner: 'MeguminBOT',
            name: 'TextureAtlas-Toolbox',
            get latestUrl() { return `https://api.github.com/repos/${this.owner}/${this.name}/releases/latest`; }
        };
        
        const REPO_V1 = {
            owner: 'MeguminBOT',
            name: 'TextureAtlas-to-GIF-and-Frames',
            tag: 'v1.9.5.1',
            get releaseUrl() { return `https://api.github.com/repos/${this.owner}/${this.name}/releases/tags/${this.tag}`; }
        };

        // Asset naming pattern for v2.0.0+:
        // <AppName>-<OS>-<Arch>-<PackageType>-<Version>.<ext>
        // Examples:
        //   TextureAtlasToolbox-win-x64-exe-v2.0.0.zip
        //   TextureAtlasToolbox-win-x64-embedded-python-v2.0.0.7z
        //   TextureAtlasToolbox-src-zip-v2.0.0.zip
        
        // Parse asset name to extract package type and format
        function parseAssetName(assetName) {
            const name = assetName.toLowerCase();
            
            // Source code patterns - check for -src- anywhere in name
            if (name.includes('-src-') || name.includes('source')) {
                if (name.endsWith('.tar.gz')) {
                    return { type: 'source', format: 'tar.gz', os: 'any' };
                }
                if (name.endsWith('.zip')) {
                    return { type: 'source', format: 'zip', os: 'any' };
                }
            }
            
            // Embedded Python patterns
            if (name.includes('-embedded-python-')) {
                const format = name.endsWith('.7z') ? '7z' : 'zip';
                const os = name.includes('-win-') ? 'windows' : name.includes('-linux-') ? 'linux' : name.includes('-mac-') ? 'macos' : 'windows';
                return { type: 'embedded', format, os };
            }
            
            // Executable patterns
            if (name.includes('-exe-')) {
                const format = name.endsWith('.7z') ? '7z' : 'zip';
                const os = name.includes('-win-') ? 'windows' : name.includes('-linux-') ? 'linux' : name.includes('-mac-') ? 'macos' : 'windows';
                return { type: 'exe', format, os };
            }
            
            // Fallback for generic Windows packages (not source)
            if ((name.endsWith('.zip') || name.endsWith('.7z')) && !name.includes('src') && !name.includes('source')) {
                const format = name.endsWith('.7z') ? '7z' : 'zip';
                return { type: 'exe', format, os: 'windows' };
            }
            
            return null;
        }

        // Create download button HTML
        function createDownloadButton(asset, isPrimary = false) {
            // Use pre-parsed data if available, otherwise parse the asset name
            const parsed = asset.parsed || parseAssetName(asset.name);
            if (!parsed) return '';
            
            const formatLabel = parsed.format.toUpperCase();
            const sizeLabel = asset.size ? ` (${formatFileSize(asset.size)})` : '';
            const btnClass = isPrimary ? 'btn btn-primary' : 'btn btn-outline';
            
            return `<a href="${asset.browser_download_url}" class="${btnClass}" title="${asset.name}">
                ${formatLabel}${sizeLabel}
            </a>`;
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Format date to readable string
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // Categorize assets by type
        function categorizeAssets(assets) {
            const categories = {
                exe: [],
                embedded: [],
                source: []
            };
            
            assets.forEach(asset => {
                const parsed = parseAssetName(asset.name);
                if (parsed && categories[parsed.type]) {
                    categories[parsed.type].push({ ...asset, parsed });
                }
            });
            
            return categories;
        }
        
        // Render download buttons for a category
        function renderCategoryButtons(assets, containerId, fallbackUrl = null) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (assets.length === 0) {
                container.innerHTML = '<span class="btn btn-disabled">Coming soon..</span>';
                return;
            }
            
            // Sort: zip first, then 7z
            assets.sort((a, b) => {
                if (a.parsed.format === 'zip' && b.parsed.format !== 'zip') return -1;
                if (a.parsed.format !== 'zip' && b.parsed.format === 'zip') return 1;
                return 0;
            });
            
            const buttons = assets.map((asset, i) => createDownloadButton(asset, i === 0)).join('');
            container.innerHTML = buttons;
        }

        // Fetch and update v2.x release info
        async function fetchV2Release() {
            try {
                const response = await fetch(REPO_V2.latestUrl);
                if (!response.ok) throw new Error('API request failed');
                
                const release = await response.json();
                const version = release.tag_name;
                const date = formatDate(release.published_at);
                
                document.getElementById('v2-version').textContent = version;
                document.getElementById('v2-date').textContent = date;
                
                // Categorize and render assets
                const categories = categorizeAssets(release.assets);
                
                renderCategoryButtons(categories.exe, 'v2-exe-buttons', release.html_url);
                renderCategoryButtons(categories.embedded, 'v2-embedded-buttons', release.html_url);
                
                // Always use GitHub's auto-generated source archives for reliability
                const sourceAssets = [
                    { 
                        name: 'source-zip', 
                        browser_download_url: release.zipball_url,
                        size: null,
                        parsed: { type: 'source', format: 'zip', os: 'any' }
                    },
                    { 
                        name: 'source-tar.gz', 
                        browser_download_url: release.tarball_url,
                        size: null,
                        parsed: { type: 'source', format: 'tar.gz', os: 'any' }
                    }
                ];
                renderCategoryButtons(sourceAssets, 'v2-source-buttons');
                
            } catch (error) {
                console.warn('Failed to fetch v2 release info:', error);
                // Show fallback info if API fails
                document.getElementById('v2-version').textContent = 'v2.0.0';
                document.getElementById('v2-date').textContent = 'View on GitHub';
                
                const fallbackHtml = '<a href="https://github.com/MeguminBOT/TextureAtlas-Toolbox/releases/latest" class="btn btn-outline">View on GitHub</a>';
                ['v2-exe-buttons', 'v2-embedded-buttons', 'v2-source-buttons'].forEach(id => {
                    const container = document.getElementById(id);
                    if (container) {
                        container.innerHTML = fallbackHtml;
                    }
                });
            }
        }

        // Fetch and update v1.x release info
        async function fetchV1Release() {
            try {
                const response = await fetch(REPO_V1.releaseUrl);
                if (!response.ok) throw new Error('API request failed');
                
                const release = await response.json();
                const version = release.tag_name;
                const date = formatDate(release.published_at);
                
                document.getElementById('v1-version').textContent = version;
                document.getElementById('v1-date').textContent = `Released ${date}`;
                
                // Find Windows asset for v1 (simpler logic)
                const windowsAsset = release.assets.find(asset => 
                    asset.name.toLowerCase().includes('win') || 
                    asset.name.endsWith('.zip') || 
                    asset.name.endsWith('.7z')
                );
                
                if (windowsAsset) {
                    document.getElementById('v1-download').href = windowsAsset.browser_download_url;
                    document.getElementById('v1-download').textContent = `üíæ Download ${version} for Windows 64-bit`;
                } else {
                    document.getElementById('v1-download').href = release.html_url;
                }
            } catch (error) {
                console.warn('Failed to fetch v1 release info:', error);
                document.getElementById('v1-version').textContent = 'v1.9.5.1';
                document.getElementById('v1-date').textContent = 'Final v1 Release';
            }
        }

        // Fetch both releases on page load
        document.addEventListener('DOMContentLoaded', () => {
            fetchV2Release();
            fetchV1Release();
        });
    </script>
</body>
</html>
